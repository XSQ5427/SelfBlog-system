<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>博客详情</title>
    <script src="/js/jquery-3.6.0.min.js"></script>
</head>
<body>
<h2 th:text="${title}"></h2>
<br>
<table>
    <tr>
        <td>发布时间: <span th:text="${publishTime}"></span></td>
        <td width="20px"></td>
        <td>浏览次数: <span th:text="${scanCount}" id="scan_count"></span></td>
        <td width="20px"></td>
        <td>喜欢次数: <span id="likeCount" th:text="${likeCount}"></span></td>
        <td width="20px"></td>
        <td th:if="${hasLiked} !=null" id="btnTd">
            <button th:if="${hasLiked} eq '1'" onclick="dislike()">取消喜欢</button>
            <button th:if="${hasLiked} eq '0'" onclick="like()">喜欢</button>
        </td>
    </tr>
</table>
<hr>
<div th:text="${content}">
</div>
<hr>
<input type="text" th:value="${id}" id="blog_id" style="display:none"></input>
<script>
    let blogId = $("#blog_id").val();
    $.ajax({
        type: 'POST',
        url: '/blog/' + blogId + '/scan',
        contentType: 'application/json',
        withCredentials: true,
        success: function(data){
            $("#scan_count").text(data);
        },
        error: function(data) {
            alert("浏览计数失败！");
            console.log(data);
            return;
        }
    });

    // 点赞功能
    function like(){
        $.ajax({
            type: 'POST',
            url: '/blog/' + blogId + '/like',
            withCredentials: true,
            success: function(data){
                if("1" == data){
                    let likeCountSpan = $("#likeCount");
                    likeCountSpan.text(parseInt(likeCountSpan.text()) + 1);
                    $("#btnTd").html('<button onclick="dislike()">取消喜欢</button>');
                }
            },
            error: function(data){
                // 失败后执行的代码
                alert("点赞失败！如未登陆，请先登陆！");
                console.log(data);
                return;
            }
        });
    }
    // 取消点赞功能
    function dislike(){
        $.ajax({
            type: 'POST',
            url: '/blog/' + blogId + '/dislike',
            withCredentials: true,
            success: function(data){
                if("1"== data){
                    let likeCountSpan = $("#likeCount");
                    likeCountSpan.text(parseInt(likeCountSpan.text()) - 1);
                    $("#btnTd").html('<button onclick="like()">喜欢</button>');
                }
            },
            error: function(data){
                alert("取消点赞失败！如未登陆，请先登陆！");
                console.log(data);
                return;
            }
        });
    }
</script>
</body>
</html>